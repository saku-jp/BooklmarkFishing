<html>
	<head>
		<meta http-equiv="Pragma" content="no-cache">
		<meta http-equiv="Cache-Control" content="no-cache">
		<title>ブックマーク</title>
	</head>

	<!-- データ部 -->
	<!--
		【ブックマークリストのデータ構造】
		title : HTML文書のタイトル
		bookmark_list : ブックマークの配列
			[ブックマークの構造]
			text : リンクに表示されるテキスト
			url : リンク先のURL（下位階層がある場合無効）
			discription : テキストの右に表示される説明（【】で囲まれて表示される）
			bookmark_list : 下位階層のブックマークの配列（以下再帰構造）
	-->
	<script id="bookmarkData" type="application/json">
		{
			"title": "釣り関係のブックマーク"
			, "bookmark_list": [
				{
					"text": "海天気.jp"
					, "bookmark_list": [
						{
							"text": "宇野港"
							, "url": "https://www.umitenki.jp/tenki/3283/3hours"
						}
						, {
							"text": "下津井漁港"
							, "url": "https://www.umitenki.jp/tenki/3319/3hours"
						}
						, {
							"text": "笠岡港"
							, "url": "https://www.umitenki.jp/tenki/3298/3hours"
						}
						, {
							"text": "小飛島港"
							, "url": "https://www.umitenki.jp/tenki/3303/3hours"
						}
						, {
							"text": "宮浦港（直島）"
							, "url": "https://www.umitenki.jp/tenki/3919/3hours"
						}
						, {
							"text": "牛窓"
							, "url": "https://www.umitenki.jp/tenki/3282/3hours"
						}
					]
				}
				, {
					"text": "天気予報（岡山）"
					, "bookmark_list": [
						{
							"text": "岡山市南区(tenki.jp)"
							, "url": "https://tenki.jp/forecast/7/36/6610/33104/"
						}
						, {
							"text": "玉野市(tenki.jp)"
							, "url": "https://tenki.jp/forecast/7/36/6610/33204/"
						}
						, {
							"text": "倉敷市(tenki.jp)"
							, "url": "https://tenki.jp/forecast/7/36/6610/33202/"
						}
						, {
							"text": "笠岡市(tenki.jp)"
							, "url": "https://tenki.jp/forecast/7/36/6610/33205/"
						}
						, {
							"text": "瀬戸内市(tenki.jp)"
							, "url": "https://tenki.jp/forecast/7/36/6610/33212/"
						}
						, {
							"text": "備前市(tenki.jp)"
							, "url": "https://tenki.jp/forecast/7/36/6610/33211/"
						}
						, {
							"text": "岡山県(気象庁)"
							, "url": "https://www.jma.go.jp/jp/yoho/340.html"
						}
					]
				}
				, {
					"text": "天気予報（香川）"
					, "bookmark_list": [
						{
							"text": "高松市(tenki.jp)"
							, "url": "https://tenki.jp/forecast/8/40/7200/37201/"
						}
						, {
							"text": "土庄町(tenki.jp)"
							, "url": "https://tenki.jp/forecast/8/40/7200/37322/"
						}
						, {
							"text": "坂出市(tenki.jp)"
							, "url": "https://tenki.jp/forecast/8/40/7200/37203/"
						}
						, {
							"text": "観音寺市(tenki.jp)"
							, "url": "https://tenki.jp/forecast/8/40/7200/37205/"
						}
						, {
							"text": "香川県(気象庁)"
							, "url": "https://www.jma.go.jp/jp/yoho/341.html"
						}
					]
				}
				, {
					"text": "Windy"
					, "bookmark_list": [
						{
							"text": "風"
							, "url": "https://www.windy.com/?34.443,133.879,11"
						}
						, {
							"text": "風浪"
							, "url": "https://www.windy.com/ja/-%E9%A2%A8%E6%B5%AA-wwaves?wwaves,34.443,133.879,11"
						}
						, {
							"text": "海流"
							, "url": "https://www.windy.com/ja/-%E6%B5%B7%E6%B5%81-currents?currents,34.443,133.879,11"
						}
					]
				}
				, {
					"text": "潮見表"
					, "bookmark_list": [
						{
							"text": "宇野"
							, "url": "http://sio.mieyell.jp/select?po=63306"
						}
						, {
							"text": "下津井"
							, "url": "http://sio.mieyell.jp/select?po=63307"
						}
						, {
							"text": "笠岡"
							, "url": "http://sio.mieyell.jp/select?po=63309"
						}
						, {
							"text": "牛窓"
							, "url": "http://sio.mieyell.jp/select?po=63303"
						}
						, {
							"text": "高松"
							, "url": "http://sio.mieyell.jp/select?po=73708"
						}
					]
				}
				, {
					"text": "交通"
					, "bookmark_list": [
						{
							"text": "直島航路時刻表（四国汽船）"
							, "url": "https://www.shikokukisen.com/instant/"
						}
						, {
							"text": "笠岡航路時刻表（三洋汽船)"
							, "url": "https://sanyo-kisen.jp/%E6%99%82%E5%88%BB%E8%A1%A8"
						}
					]
				}
			]
		}
	</script>

	<!-- 表示部 -->
	<body style="font-size: 400%;">
		<input style="font-size: 100%;" type="button" value="全て開く" id="toggleChildList_top" onclick="toggleAllChildList();" />
		<ul style="ul_top" id="bookmarkList">
		</ul>
		<input style="font-size: 100%;" type="button" value="全て開く" id="toggleChildList_buttom" onclick="toggleAllChildList();" />
	</body>

	<!-- 処理部 -->
	<script>
		/*
		ページ表示時に処理されるメイン処理
		*/
		// [public]ブックマークリストの表示／非表示のDOM要素(ulタグ)のIDを生成するためのカウンタ
		var ulCount = 0;
		// [public]ブックマークリストの階層レベル
		var ulLevel = 0;
		// GETパラメータからブックマークデータのIDを取得する
		var param = window.location.search;
		var bookmarkDataId = ((!isUndef(param) && (param.length > 2)) ? param.substring(1) : "bookmarkData");
		// ブックマークデータ(JSON)を取得する
		var bookmarkListData = getBookmarkListData(bookmarkDataId);
		if (bookmarkListData != null) {
			// タイトルを設定する
			if (!isUndef(bookmarkListData.title)) {
				document.title = bookmarkListData.title;
			}
			// HTML文書内の最上位層のulタグを取得する
			var ul = document.getElementById("bookmarkList");
			ul.style.listStyle = "none";
			// 取得したブックマークデータからブックマークリストを作成する
			createBookmarkList(bookmarkListData.bookmark_list, ul);
		}
		// [public]下位階層の全てのブックマークリストの表示／非表示の状態
		var isShowAllChildList = false;
		// 初期表示は全てのブックマークリストを非表示に設定する
		toggleAllChildList();

		/*
		HTML文書内のブックマークリストのデータを取得する
			@return ブックマークリストのデータ(JSON)
			ブックマークリストのデータの取得先を変更する場合、このメソッドを変更する。
		*/
		function getBookmarkListData(bookmarkDataId) {
			// HTML文書内のブックマークデータ(JSON)を取得する
			var jsonData = document.getElementById(bookmarkDataId);
			return ((jsonData != null) ? JSON.parse(jsonData.innerHTML) : null);
		}

		/*
		ブックマークデータからブックマークリストを作成する
			@param bookmarkListData ブックマークリストデータ(JSON)
			@param ul ulタグ(DOM)
			@return なし
			再帰で呼び出して下位階層のブックマークリストの作成する。
		*/
		function createBookmarkList(bookmarkListData, ul) {
			incUlLevel();
			bookmarkListData.forEach(
				function (bookmark) {

					// aタグを生成する
					var a = document.createElement("a");
					// URLが指定されているかつ下位階層がない場合、aタグのhref属性を設定する
					if (!isUndef(bookmark.url) && isUndef(bookmark.bookmark_list)) {
						a.href = bookmark.url;
					}
					// ターゲットが指定されている場合、aタグのtarget属性を設定する
					if (!isUndef(bookmark.target)) {
						a.target = bookmark.target;
					} else {
						// ターゲットが指定されていない場合、固定(new)のターゲットに表示する
						a.target = "new";
					}
					// 表示テキストのテキスト要素を生成する（下位階層がある場合、マークを付加）
					var txt = document.createTextNode((!isUndef(bookmark.bookmark_list) ? "▼" : "") + bookmark.text);
					// aタグの子要素にテキスト要素を追加する
					a.appendChild(txt);

					// ブックマークのliタグを生成する
					var li = document.createElement("li");
					// liタグの子要素にaタグを追加する				
					li.appendChild(a);

					// 説明がある場合、liタグの子要素に説明のテキスト要素を追加する
					if (!isUndef(bookmark.discription)) {
						li.appendChild(document.createTextNode("【" + bookmark.discription + "】"))
					}

					// 下位階層がある場合、下位階層のブックマークリストを作成する
					if (!isUndef(bookmark.bookmark_list)) {
						// 下位階層のulタグを生成する
						var chdUl = document.createElement("ul");
						// ulタグにIDを設定する（JavaScriptで表示／非表示を制御するため）
						var chdUlId = createUlId();
						chdUl.id = chdUlId;
						// 第２階層以下は非表示にする
						chdUl.style.display = ((ulLevel > 0) ? "none" : "block");
						// ブックマークリストの先頭には何も表示しない
						chdUl.style.listStyle = "none";
						// 下位階層のブックマークリストの表示／非表示を制御するためのstyle属性を設定する
						a.setAttribute("onclick", "toggleChildList('" + chdUlId + "'); return false;");
						// 下位階層のブックマークリストの表示／非表示を制御するためのJavaScriptを設定する
						a.setAttribute("onclick", "toggleChildList('" + chdUlId + "'); return false;");
						// 下位階層のブックマークリストを作成する
						createBookmarkList(bookmark.bookmark_list, chdUl);
						// 作成したブックマークリストのulタグをliタグの子要素に追加する
						li.appendChild(chdUl);
					}

					// 上位階層のulタグにブックマークのliタグを追加する
					ul.appendChild(li);

				}
			);
			decUlLevel();
		}

		/*
		ブックマークリストの表示／非表示のDOM要素(ulタグ)のIDを生成する
			@return DOM要素(ulタグ)のID
		*/
		function createUlId() {
			return "ul_" + String(ulCount++);
		}

		/*
		ブックマークリストの階層レベルをインクリメントする
			@return ブックマークリストの階層レベル
		*/
		function incUlLevel() {
			return ulLevel++;
		}

		/*
		ブックマークリストの階層レベルをデクリメントする
			@return ブックマークリストの階層レベル
		*/
		function decUlLevel() {
			return ulLevel--;
		}

		/*
		オブジェクトがundefinedかどうか判定する
			@param o オブジェクト
			@return 判定結果（true:undefinedである、false:undefinedでない）
		*/
		function isUndef(o) {
			return o === undefined;
		}

		/*
		下位階層のブックマークリストの表示／非表示を切り替える
			@param id 切り替えるブックマークリストのID
			@return なし
		*/
		function toggleChildList(id) {
			var chdUl = document.getElementById(id);
			if (!isUndef(chdUl)) {
				if (chdUl.style.display == "none") {
					chdUl.style.display = "block";
				} else {
					chdUl.style.display = "none";
				}
			}
		}

		/*
		下位階層の全てのブックマークリストの表示／非表示を切り替える
			@return なし
		*/
		function toggleAllChildList() {
			// 下位階層の全てのブックマークリストの表示／非表示を切り替える
			Array.from(document.getElementsByTagName("ul")).forEach(
				function (dom) {
					if (dom.id.match(/^ul_.*$/)) {
						dom.style.display = ((isShowAllChildList) ? "block" : "none");
					}
				}
			);
			// ボタンの表示テキストを切り替える
			Array.from(document.getElementsByTagName("input")).forEach(
				function (dom) {
					if (dom.id.match(/^toggleChildList_.*$/)) {
						dom.value = ((isShowAllChildList) ? "全て閉じる" : "全て開く");
					}
				}
			);
			// 全てのブックマークリストの表示／非表示の状態を切り替える
			isShowAllChildList = !isShowAllChildList;
		}
	</script>
</html>
